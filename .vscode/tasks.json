{
  // See https://go.microsoft.com/fwlink/?LinkId=733558
  // for the documentation about the tasks.json format
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Build Dependencies (Make Directory)",
      "type": "shell",
      "windows": {
        "command": "if (-not (Test-Path 'build-deps')) { mkdir 'build-deps' }"
      },
      "linux": {
        "command": "mkdir -p 'build-deps'",
      },
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": []
    },
    {
      "label": "Build Dependencies (Clean)",
      "type": "shell",
      "windows": {
        "command": "if (Test-Path 'x64/${input:configuration}') { rm -r 'x64/${input:configuration}' }"
      },
      "linux": {
        // not sure what to do yet
      },
      "options": {
        "cwd": "${workspaceFolder}/build-deps"
      },
      "problemMatcher": []
    },
    {
      "label": "Build Dependencies (CMake Configure)",
      "type": "shell",
      "windows": {
        "command": "C:\\Program Files\\CMake\\bin\\cmake.EXE",
        "args": [
          "-G",
          "Visual Studio 16 2019",
          "-T",
          "host=x64",
          "-A",
          "x64",
          "--no-warn-unused-cli",
          "-Dopenvkl_ROOT=${workspaceFolder}/../openvkl", // build customized OpenVKL
          "-DBUILD_OIDN=ON",
          "-DBUILD_EMBREE_FROM_SOURCE:BOOL=FALSE",
          "-DBUILD_DEPENDENCIES_ONLY:BOOL=TRUE",
          "-DINSTALL_IN_SEPARATE_DIRECTORIES:BOOL=TRUE",
          "-DCMAKE_EXPORT_COMPILE_COMMANDS:BOOL=TRUE",
          "-H${workspaceFolder}/scripts/superbuild",
          "-B${workspaceFolder}/build-deps"
        ]
      },
      "linux": {
        "command": "cmake",
        "args": [
          "--no-warn-unused-cli",
          "-DBUILD_OIDN=ON",
          "-DBUILD_EMBREE_FROM_SOURCE:BOOL=FALSE",
          "-DBUILD_DEPENDENCIES_ONLY:BOOL=TRUE",
          "-DINSTALL_IN_SEPARATE_DIRECTORIES:BOOL=TRUE",
          "-DCMAKE_EXPORT_COMPILE_COMMANDS:BOOL=TRUE",
          "-H${workspaceFolder}/scripts/superbuild",
          "-B${workspaceFolder}/build-deps"
        ],
      },
      "dependsOrder": "sequence",
      "dependsOn": [
        "Build Dependencies (Make Directory)",
        "Build Dependencies (Clean)"
      ],
      "problemMatcher": []
    },
    {
      "label": "Build Dependencies (CMake Build)",
      "type": "shell",
      "windows": {
        "command": "C:\\Program Files\\CMake\\bin\\cmake.EXE",
      },
      "linux": {
        "command": "cmake",
      },
      "args": [
        "--build",
        "${workspaceFolder}/build-deps",
        "--config",
        "${input:configuration}",
        "--parallel",
        "20"
      ],
      "dependsOrder": "sequence",
      "dependsOn": [
        "Build Dependencies (CMake Configure)"
      ],
      "problemMatcher": []
    },
    // rebuild OpenVKL
    {
      "label": "Rebuild OpenVKL",
      "type": "shell",
      "windows": {
        "command": "C:\\Program Files\\CMake\\bin\\cmake.EXE",
      },
      "linux": {
        "command": "cmake",
      },
      "args": [
        "--build",
        "${workspaceFolder}/build-deps/openvkl/build",
        "--config",
        "${input:configuration}",
        "--target",
        "install",
        "--parallel",
        "20"
      ],
      "problemMatcher": []
    }
  ],
  "inputs": [
    {
      "type": "pickString",
      "id": "configuration",
      "description": "What type of configuration do you want to create?",
      "options": [
        "Debug",
        "Release",
        "RelWithDebInfo"
      ],
      "default": "RelWithDebInfo"
    },
  ]
}